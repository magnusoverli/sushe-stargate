<%- layout('layouts/main') %>

<div class="min-h-screen bg-black">
  <!-- Header -->
  <header class="bg-gray-900 border-b border-gray-800 p-4">
    <div class="flex items-center justify-between">
      <div class="flex items-center gap-4">
        <a href="/" class="text-gray-400 hover:text-white">
          <i class="fas fa-arrow-left"></i>
        </a>
        <h1 class="text-xl font-semibold">Admin Panel</h1>
      </div>
      <div class="flex gap-2">
        <button onclick="exportUsers()" class="btn-secondary text-sm">
          <i class="fas fa-download mr-1"></i>Export Users
        </button>
        <button onclick="downloadBackup()" class="btn-secondary text-sm">
          <i class="fas fa-database mr-1"></i>Backup
        </button>
      </div>
    </div>
  </header>
  
  <div id="admin-panel" class="p-4 lg:p-6">
    <!-- Stats Cards -->
    <div class="grid grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
      <div class="bg-gray-900 rounded-lg p-4">
        <div class="text-2xl font-bold" id="total-users"><%= stats.totalUsers %></div>
        <div class="text-sm text-gray-400">Total Users</div>
      </div>
      <div class="bg-gray-900 rounded-lg p-4">
        <div class="text-2xl font-bold" id="total-lists"><%= stats.totalLists %></div>
        <div class="text-sm text-gray-400">Total Lists</div>
      </div>
      <div class="bg-gray-900 rounded-lg p-4">
        <div class="text-2xl font-bold" id="total-albums"><%= stats.totalAlbums %></div>
        <div class="text-sm text-gray-400">Total Albums</div>
      </div>
      <div class="bg-gray-900 rounded-lg p-4">
        <div class="text-2xl font-bold" id="active-users"><%= stats.activeUsers %></div>
        <div class="text-sm text-gray-400">Active Users (7d)</div>
      </div>
    </div>
    
    <!-- Users Table -->
    <div class="bg-gray-900 rounded-lg p-6 mb-6">
      <div class="flex items-center justify-between mb-4">
        <h2 class="text-lg font-semibold">Users</h2>
        <input type="text" id="user-search" placeholder="Search users..." 
               class="input-dark w-64">
      </div>
      
      <div class="overflow-x-auto">
        <table id="users-table" class="table-dark">
          <thead>
            <tr>
              <th>Email</th>
              <th>Username</th>
              <th>Role</th>
              <th>Lists</th>
              <th>Created</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <% users.forEach(user => { %>
              <tr>
                <td><%= user.email %></td>
                <td><%= user.username %></td>
                <td>
                  <% if (user.role === 'admin') { %>
                    <span class="text-accent">Admin</span>
                  <% } else { %>
                    <span class="text-gray-400">User</span>
                  <% } %>
                </td>
                <td><%= user.listCount %></td>
                <td><%= new Date(user.createdAt).toLocaleDateString() %></td>
                <td>
                  <div class="flex gap-2">
                    <% if (user.role !== 'admin') { %>
                      <button onclick="makeAdmin('<%= user._id %>')" 
                              class="text-xs bg-green-600 hover:bg-green-700 px-2 py-1 rounded">
                        Make Admin
                      </button>
                    <% } else if (user._id !== locals.user._id) { %>
                      <button onclick="revokeAdmin('<%= user._id %>')" 
                              class="text-xs bg-yellow-600 hover:bg-yellow-700 px-2 py-1 rounded">
                        Revoke Admin
                      </button>
                    <% } %>
                    <button onclick="viewUserLists('<%= user._id %>')" 
                            class="text-xs bg-blue-600 hover:bg-blue-700 px-2 py-1 rounded">
                      View Lists
                    </button>
                    <% if (user._id !== locals.user._id) { %>
                      <button onclick="deleteUser('<%= user._id %>')" 
                              class="text-xs bg-red-600 hover:bg-red-700 px-2 py-1 rounded">
                        Delete
                      </button>
                    <% } %>
                  </div>
                </td>
              </tr>
            <% }) %>
          </tbody>
        </table>
      </div>
    </div>
    
    <!-- Activity Stream -->
    <div class="bg-gray-900 rounded-lg p-6">
      <h2 class="text-lg font-semibold mb-4">Recent Activity</h2>
      <div id="activity-stream" class="space-y-2 max-h-96 overflow-y-auto">
        <!-- Activity items will be loaded here -->
      </div>
    </div>
    
    <!-- System Actions -->
    <div class="bg-gray-900 rounded-lg p-6 mt-6">
      <h2 class="text-lg font-semibold mb-4">System Actions</h2>
      <div class="flex gap-3">
        <button onclick="clearAllSessions()" class="btn-secondary">
          <i class="fas fa-user-slash mr-2"></i>Clear All Sessions
        </button>
      </div>
    </div>
  </div>
</div>

<script src="/js/admin.js"></script>