<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <title>SuShe Stargate</title>
  
  <!-- Meta tags -->
  <meta name="description" content="Personal music album collection manager">
  <meta name="theme-color" content="#000000">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  <!-- User data -->
  <% if (user) { %>
    <meta name="user-accent-color" content="<%= user.accentColor %>">
    <meta name="last-selected-list" content="<%= user.lastSelectedList %>">
  <% } %>
  
  <!-- Styles -->
  <link rel="stylesheet" href="/css/output.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

</head>
<body class="bg-black text-white min-h-screen">
  <%- body %>
  
  <!-- Global scripts -->
  <script>
    // Reference data
    window.countries = <%- JSON.stringify(countries || []) %>;
    window.genres = <%- JSON.stringify(genres || []) %>;
  </script>
  
  <!-- Theme initialization - runs on every page -->
  <script>
    // Apply user theme immediately
    (function() {
      const accentColor = document.querySelector('meta[name="user-accent-color"]')?.content || '#dc2626';
      
      const hex2rgb = hex => {
        const result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
        return result ? {
          r: parseInt(result[1], 16),
          g: parseInt(result[2], 16),
          b: parseInt(result[3], 16)
        } : null;
      };
      
      const rgb = hex2rgb(accentColor);
      if (rgb) {
        // Calculate variations
        const hover = `#${Math.min(255, rgb.r + 30).toString(16).padStart(2, '0')}${Math.min(255, rgb.g + 30).toString(16).padStart(2, '0')}${Math.min(255, rgb.b + 30).toString(16).padStart(2, '0')}`;
        const light = `#${Math.min(255, rgb.r + 100).toString(16).padStart(2, '0')}${Math.min(255, rgb.g + 100).toString(16).padStart(2, '0')}${Math.min(255, rgb.b + 100).toString(16).padStart(2, '0')}`;
        const dark = `#${Math.max(0, rgb.r - 50).toString(16).padStart(2, '0')}${Math.max(0, rgb.g - 50).toString(16).padStart(2, '0')}${Math.max(0, rgb.b - 50).toString(16).padStart(2, '0')}`;
        
        // Apply to CSS variables
        document.documentElement.style.setProperty('--accent-color', accentColor);
        document.documentElement.style.setProperty('--accent-color-hover', hover);
        document.documentElement.style.setProperty('--accent-color-light', light);
        document.documentElement.style.setProperty('--accent-color-dark', dark);
        document.documentElement.style.setProperty('--accent-color-shadow', `rgba(${rgb.r}, ${rgb.g}, ${rgb.b}, 0.5)`);
      }
    })();
  </script>
  
  <!-- Include theme.js on all pages -->
  <script src="/js/theme.js"></script>
</body>
</html>